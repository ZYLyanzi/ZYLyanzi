webpackJsonp([1],{"9EQR":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("BO1k"),i=a.n(s),r=a("MS2J"),l=a("g7Rx"),n=a("E32z"),o=(a("NYxO"),{components:{bootomTap:n.a},data:function(){return{username:"",taskType:"",id:0,token:"",titleText:"发布任务",btnText:"发布任务",validCount:0,tapName:"add",imgList:[],unitPrice:0,markupPrice:0,totalPrice:0,totalSum:0,taskParams:{taskName:"",userName:"",taskType:0,limitSpeed:0,endTime:"",taskTypeAttrs:[]},taskTypes:[],rules:{unitPrice:{itRequried:{reg:!0,msg:""},itType:{reg:"",msg:""},itLen:{reg:9,msg:""},itState:"",itMsg:""},markupPrice:{itRequried:{reg:!1,msg:""},itType:{reg:"",msg:""},itLen:{reg:9,msg:""},itState:"",itMsg:""},totalSum:{itRequried:{reg:!0,msg:""},itType:{reg:"",msg:""},itLen:{reg:9,msg:""},itState:"",itMsg:""}}}},created:function(){this.token=localStorage.token;var t=new Date;t.setTime(t.getTime()+864e5);var e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":00";if(this.$route.params.id&&0!=this.$route.params.id)this.id=this.$route.params.id,this.btnText="确认修改",this.titleText="编辑任务",this.getInfo();else{this.taskParams.endTime=e;var a=this,s={userName:localStorage.userName};l.a.queryTaskType(s).then(function(t){1==t.msgCode&&(a.taskTypes=t.taskTypes,a.taskParams.id=t.taskTypes[0].id,a.unitPrice=t.taskTypes[0].defPrice,a.taskParams.taskTypeAttrs=t.taskTypes[0].taskTypeAttrs,a.taskParams.taskName=t.taskTypes[0].name+"任务")})}},methods:{getInfo:function(){var t=this,e={taskId:t.id};l.a.taskDesc(e).then(function(e){1==e.msgCode&&(t.taskParams=e.task,t.unitPrice=e.task.unitPrice,t.markupPrice=e.task.markupPrice,t.totalPrice=e.task.totalPrice,t.totalSum=e.task.totalSum,t.setImg("edit"))})},handlePostSuccess:function(t,e){console.log("文件上传成功钩子",t);1==t.msgCode&&this.imgList.push({name:t.filePath,url:t.filePath})},setImg:function(t){var e=!0,a=!1,s=void 0;try{for(var r,l=i()(this.taskParams.taskTypeAttrs);!(e=(r=l.next()).done);e=!0){var n=r.value;if("img"==n.fileType)if("edit"==t){var o=!0,m=!1,u=void 0;try{for(var c,d=i()(n.fieldConten);!(o=(c=d.next()).done);o=!0){var p=c.value;this.imgList.push({name:p,url:p})}}catch(t){m=!0,u=t}finally{try{!o&&d.return&&d.return()}finally{if(m)throw u}}}else if("add"==t){var k=!0,f=!1,v=void 0;try{for(var P,h=i()(this.imgList);!(k=(P=h.next()).done);k=!0){var g=P.value;n.fieldConten.push(g.url)}}catch(t){f=!0,v=t}finally{try{!k&&h.return&&h.return()}finally{if(f)throw v}}}}}catch(t){a=!0,s=t}finally{try{!e&&l.return&&l.return()}finally{if(a)throw s}}},handleRemove:function(t,e){console.log(t,e)},handlePreview:function(t){console.log(t)},changeType:function(t){console.log("itemData",t),this.taskParams.id=t.id,this.unitPrice=t.defPrice,this.taskParams.taskTypeAttrs=t.taskTypeAttrs,this.taskParams.taskName=t.name+"任务"},addTask:function(){var t=this;for(var e in this.validCount=0,this.rules)this.validCount+=r.a.byOneValid(this[e],this.rules[e]);if(this.validCount>0);else{var a=this;a.taskParams.userName=localStorage.userName,a.taskParams.unitPrice=a.unitPrice,a.taskParams.markupPrice=a.markupPrice,a.taskParams.totalPrice=a.totalPrice,a.taskParams.totalSum=a.totalSum,a.setImg("add"),a.id&&0!=a.id?l.a.updateTask(a.taskParams).then(function(e){1==e.msgCode&&(alert("修改成功"),t.$router.replace({path:"/task/list"}))}):l.a.addTask(a.taskParams).then(function(e){1==e.msgCode&&(alert("添加成功"),t.$router.replace({path:"/task/list"}))})}}},watch:{markupPrice:function(t){this.totalPrice=(parseInt(this.unitPrice)+parseInt(t))*parseInt(this.totalSum)},totalSum:function(t){this.totalPrice=(parseInt(this.unitPrice)+parseInt(this.markupPrice))*parseInt(t)}}}),m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("mt-header",{attrs:{title:t.titleText}}),t._v(" "),a("div",{staticClass:"main"},[t.id?t._e():a("div",{staticClass:"layout task-type"},[a("div",{staticClass:"field"},[t._v("任务类型")]),t._v(" "),a("div",{staticClass:"part"},t._l(t.taskTypes,function(e){return a("div",{staticClass:"rw-radio",on:{click:function(a){t.changeType(e)}}},[a("i",{staticClass:"radio-icon ico",class:{selected:e.id==t.taskParams.id}}),a("span",[t._v(t._s(e.name))])])}))]),t._v(" "),a("div",{staticClass:"layout"},[a("mt-field",{attrs:{label:"名称",type:"text",min:"1"},model:{value:t.taskParams.taskName,callback:function(e){t.$set(t.taskParams,"taskName",e)},expression:"taskParams.taskName"}}),t._v(" "),a("mt-field",{attrs:{label:"单价",disabled:"",type:"number",min:"1",state:t.rules.unitPrice.itState},model:{value:t.unitPrice,callback:function(e){t.unitPrice=e},expression:"unitPrice"}}),t._v(" "),a("mt-field",{attrs:{label:"置顶加价",placeholder:"请输入置顶加价",type:"number",min:"1",state:t.rules.markupPrice.itState},model:{value:t.markupPrice,callback:function(e){t.markupPrice=e},expression:"markupPrice"}}),t._v(" "),a("mt-field",{attrs:{label:"数量",placeholder:"请输入数量",type:"number",min:"1",state:t.rules.totalSum.itState},model:{value:t.totalSum,callback:function(e){t.totalSum=e},expression:"totalSum"}}),t._v(" "),a("mt-field",{attrs:{label:"总价",disabled:"",type:"number",min:"1"},model:{value:t.totalPrice,callback:function(e){t.totalPrice=e},expression:"totalPrice"}}),t._v(" "),a("mt-field",{attrs:{label:"限速",placeholder:"请输入限速",type:"number",min:"1"},model:{value:t.taskParams.limitSpeed,callback:function(e){t.$set(t.taskParams,"limitSpeed",e)},expression:"taskParams.limitSpeed"}})],1),t._v(" "),a("div",{staticClass:"layout"},t._l(t.taskParams.taskTypeAttrs,function(e){return a("div",["text"==e.formType?a("mt-field",{attrs:{label:e.fieldCname,placeholder:e.fieldCname},model:{value:e.fieldConten,callback:function(a){t.$set(e,"fieldConten",a)},expression:"fieldItem.fieldConten"}}):t._e(),t._v(" "),"img"==e.formType?a("div",{staticClass:"upload-part"},[a("div",{staticClass:"title"},[t._v(t._s(e.fieldCname))]),t._v(" "),a("el-upload",{staticClass:"rw-upload",attrs:{action:"http://120.78.203.150:8080/RddTaskService/api/common/uploadimg",headers:{token:t.token},"on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-success":t.handlePostSuccess,limit:5,"file-list":t.imgList,"list-type":"picture"}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])],1)],1):t._e()],1)})),t._v(" "),a("div",{staticClass:"layout"},[a("mt-field",{attrs:{label:"结束时间",type:"text",disabled:""},model:{value:t.taskParams.endTime,callback:function(e){t.$set(t.taskParams,"endTime",e)},expression:"taskParams.endTime"}}),t._v(" "),a("mt-field",{attrs:{label:"备注",type:"textarea"},model:{value:t.taskParams.remark,callback:function(e){t.$set(t.taskParams,"remark",e)},expression:"taskParams.remark"}})],1),t._v(" "),a("div",{staticClass:"add-btn",on:{click:function(e){t.addTask()}}},[a("label",[t._v(t._s(t.btnText))])])]),t._v(" "),0==t.id?a("bootomTap",{attrs:{tapName:t.tapName}}):t._e()],1)},staticRenderFns:[]};var u=a("VU/8")(o,m,!1,function(t){a("xx4P")},"data-v-120df6aa",null);e.default=u.exports},BO1k:function(t,e,a){t.exports={default:a("fxRn"),__esModule:!0}},fxRn:function(t,e,a){a("+tPU"),a("zQR9"),t.exports=a("g8Ux")},g8Ux:function(t,e,a){var s=a("77Pl"),i=a("3fs2");t.exports=a("FeBl").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return s(e.call(t))}},xx4P:function(t,e){}});